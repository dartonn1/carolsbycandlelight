<!DOCTYPE html>
<html lang="en">
<head>
  <div class="background">
  <meta charset="UTF-8">
  <title>Event Message</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="style.css" rel="stylesheet">
  
</head>
<body>
  
  <!-- VIEWER SCREEN -->
  <div id="viewer">
    <div id="snow-container">
        <div class="header">
    <h2 id="title">Welcome</h2>
    <p id="message">Please waitâ€¦</p>
    <p class="small" id="footer"></p>
    </div>
    </div>
  </div>
  <!-- CONTROLLER SCREEN -->
  <div id="controller" class="hidden">
    <h1>Site Controller</h1>
    <p class="small">Tap a button to update what guests see.</p>
    <div class="controls">
      <button onclick="setMessage('Arrival',
        'Please collect any goods from our stalls and head to your checkout area.')">
        Arrival
      </button>
      <button onclick="setMessage('Find Your Seats',
        'Please begin finding your seats. We will be starting shortly.')">
        Find Seats
      </button>
      <button onclick="setMessage('We Are Beginning',
        'Thank you for being here. Please settle in as we begin.')">
        About to Begin
      </button>
      <button onclick="setMessage('Prayer',
        'Be still, and know that I am God. - Psalm 46:10')">
        Prayer
      </button>
      <button onclick="setMessage('Thank You',
        'Thank you for being part of this gathering. May peace go with you.')">
        End
      </button>
    </div>
    </div>
  </div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
  // ðŸ” CONFIG
  const SUPABASE_URL = "https://gmycaocgjaqwndcbdlmt.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdteWNhb2NnamFxd25kY2JkbG10Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5MTExMTcsImV4cCI6MjA4MTQ4NzExN30.WihrqGDXzkG1BVxBdZ4dYO2cQVbX-7gqDufetcouh4Y";
  const CONTROL_CODE = "SVP123";

  // âœ… Rename client to avoid shadowing
  const db = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_KEY
  );

  const params = new URLSearchParams(window.location.search);
  const isController = params.has("control");

  const viewer = document.getElementById("viewer");
  const controller = document.getElementById("controller");

  if (isController) {
    const entered = prompt("Enter controller access code:");
    if (entered === CONTROL_CODE) {
      viewer.classList.add("hidden");
      controller.classList.remove("hidden");
    } else {
      alert("Access denied.");
    }
  }

  // ðŸŒ Make available to buttons
  window.setMessage = async function(title, text) {
    await db.from("event_state").insert([
      { title, message: text }
    ]);
  };

  async function loadMessage() {
    const { data } = await db
      .from("event_state")
      .select("*")
      .order("updated_at", { ascending: false })
      .limit(1);

    if (!data || !data.length) return;
    updateUI(data[0]);
  }

  function updateUI(d) {
    document.getElementById("title").innerText = d.title;
    document.getElementById("message").innerText = d.message;
    document.getElementById("footer").innerText =
      "Updated at " + new Date(d.updated_at).toLocaleTimeString();
  }

  loadMessage();

  // âš¡ REALTIME
  db.channel("event-updates")
    .on(
      "postgres_changes",
      { event: "INSERT", schema: "public", table: "event_state" },
      payload => updateUI(payload.new)
    )
    .subscribe();
</script>
  
  <script src="script.js"></script>
</body>
</html>






